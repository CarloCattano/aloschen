# A LOoper

ALO is an LV2 plugin primarily targeted at the MOD Duo but hopefully it should
work on other systems too. It's based on the amp.c and metro.c lv2 example
plugins, plus some study of the loopor code.

The idea is to provide an easy, mistake-proof way to create and trigger live
music loops in sync with a click track.

- All loops are off (but being recorded in the background) by default.

- Each loop is activated and deactivated by one button.

- Loop start/end is based on the music you play at the input, so your timing
of the button hit isn't critical.

- To reset a loop so you can re-record it, double-press its button while the
loop is off.

The click/sync track is assumed to be generated by something else (e.g.
Simple Step Sequencer by x42): alo synchronises with atom time beats/bars.

## design notes
```
              1       2       3       4       1       2
.-|-.-.-.-|-.-.-.-|-.-.-.-|-.-.-.-|-.-.-.-|-.-.-.-|-.-.-.   beats

<------always recording in the background--------------->

_______/<<^^^^^^^^^^^^^^^^^^^\____________________________  audio in
       |<<| phrase-start..goes here--> |<<|

      |^^^^^^^| hit loop button anytime in this region
                now we know loop starts at nearest beat 1 
                and threshold detect for intro phrase
          |^^^^^^^^^^^^^^^^^^^\_________<<|     loop is fixed length
                                       |  |     includes phrase-start
```

- we start in 'recording' mode

- when loop button is pressed:

  if 'recording' mode:
    - figure out when phrase-start happens
    - switch to loop_on mode at next phrase_start

  if loop_on mode:
    - play the loop from (and looping at) next phrase-start

  if loop_off mode:
    - stop playing loop at next phrase-start

  - if button is pressed twice within one beat, go back to 'recording' mode

## starting MOD docker build environment

docker run -ti --name mpb -p 9000:9000 -v ~/Projects/2018/moddevices/:/tmp/aloo-lv2 moddevices/mod-plugin-builder

## build notes
```
cd /home/builder/mod-plugin-builder
rm -fr  /home/builder/mod-plugin-builder/plugins/package/alo
cp -r /tmp/moddevices/alo /home/builder/mod-plugin-builder/plugins/package
rm -fr /home/builder/mod-workdir/plugins-dep/build/alo* && ./build alo
```
## deploy notes

```
cd /home/builder/mod-workdir/plugins && tar cz alo.lv2 | base64 | curl -F 'package=@-' http://192.168.51.1/sdk/install
```
## debug notes

edit the code to set `LOG_ENABLED = true`

```
tail -f /root/alo.log`

mod-host -p 1234 -i
add http://devcurmudgeon.com/alo 0
````